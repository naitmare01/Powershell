Forked from: https://gallery.technet.microsoft.com/scriptcenter/PowerShell-function-02ac0e15
